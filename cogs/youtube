# Bibliothèques de Discord
import discord
from discord.embeds import Embed
from discord.ext import commands
from discord import app_commands
from discord.ui import View, Button

from tools.passwords import gapi
from googleapiclient.discovery import build

youtube = build("youtube", "v3", developerKey=gapi)

class Youtube(commands.Cog, name="youtube"):
    
    def __init__(self, bot) -> None:
        self.bot = bot
        super().__init__()
        
    @app_commands.command(name="ytsearch", description="Rechercher une vidéo sur Youtube")
    async def _yt_search(self, react: discord.Interaction, recherche: str, max: int):
        await self.bot.wait_until_ready()
        await react.response.defer()
        
        response = youtube.search().list(
            q=recherche,
            type="video",
            part="id, snippet",
            maxResults=max
        ).execute()
        
        for search_result in response.get('items', []):
            video_title = search_result['snippet']['title']
            video_id = search_result['id']['videoId']
        
            await react.followup.send(f"{video_title}, {video_id}")
        
        
async def setup(bot):
    await bot.add_cog(Youtube(bot))